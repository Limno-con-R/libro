# Paquetes *DiaThor* y *optimos.prime* {#diathor}

**Joaqu칤n Cochero**[^07-diathor-1]

[^07-diathor-1]: [jcochero\@ilpla.edu.ar](mailto:jcochero@ilpla.edu.ar){.email}

## Paquete *DiaThor*

*Autores: Mar칤a Mercedes Nicolosi Gelis*[^07-diathor-2]*, Mar칤a Bel칠n Sathicq*[^07-diathor-3]*, Joaqu칤n Cochero*

[^07-diathor-2]: [mercedesnicolosi\@ilpla.edu.ar](mailto:mercedesnicolosi@ilpla.edu.ar)

[^07-diathor-3]: [mbelen\@ilpla.edu.ar](mailto:mbelen@ilpla.edu.ar)

### 쯈u칠 hace?

El paquete calcula m칰ltiples **칤ndices bi칩ticos y ecol칩gicos basados en diatomeas** a partir de datos de abundancia en muestras ambientales.

### 쮺칩mo funciona?

El paquete obtiene las **preferencias ecol칩gicas** de los taxones de diatomeas vinculandolos por nombre a las bases de datos de cada 칤ndice bi칩tico y ecol칩gico. Realiza una b칰squeda exacta y luego heur칤stica del nombre del tax칩n comparandola contra distintas [Fuentes de informaci칩n ecol칩gica de las especies].

Una vez que encuentra la especie en cada alguna de las bases de datos de los distintos 칤ndices, realiza los c치lculos de los 칤ndices en base a su abundancia en las muestras, y devuelve una tabla con los valores de cada 칤ndice por muestra ingresada.

### 춰Manos a la obra!

Vamos a utilizar el set de datos del trabajo *"Exploring the use of nuclear alterations, motility and ecological guilds in epipelic diatoms as biomonitoring tools for water quality improvement in urban impacted lowland streams",* de Nicolosi Gelis et al. (2020) [@nicolosigelis2020] publicado en Ecological Indicators y disponible en el [Repositorio Institucional CONICET Digital](https://ri.conicet.gov.ar/handle/11336/128216).

#### **Descargar los datos**

Descargar los datos de ejemplo desde el repositorio del curso y guardar el archivo en el Directorio de Trabajo del Proyecto que creamos para esta Unidad (ver c칩mo hacerlo en la Unidad \@ref(intro)).

Datos de ejemplo aqu칤: <https://github.com/Limno-con-R/CILCAL2023/blob/main/datasets/sampleData_diaThor.csv>

#### Instalar el paquete

Instalaremos el paquete `diaThor`[@nicolosigelis2022] como se indica en la Unidad \@ref(intro) y los cargaremos a nuestro espacio de trabajo actual:

```{r chunk-load-library, message=FALSE, warning=FALSE}
library(diathor)
```

#### Cargar y previsualizar nuestro archivo de datos

Cargaremos nuestro archivo de ejemplo (*sampleData_diaThor.csv*) a un dataframe llamado "base":

```{r chunk-read-csv}
base <- read.csv("sampleData_diaThor.csv") #Corroborar que el nombre del archivo coincida con el que vamos a utilizar, y que se encuentre en la carpeta de nuestro proyecto

```

Veamos brevemente c칩mo est치 organizada la informaci칩n de nuestras especies:

```{r chunk-str-base, results='hide', eval=FALSE}
str(base)
```

`base` es un objeto `data.frame` con 164 `obs.` o filas (especies) y 110 `variables` o columnas (muestras).

Nuestra planilla de datos adem치s contiene una **columna obligatoria** llamada "***species***", la primera, adonde debremos ingresar los nombres de las especies lo mejor que podamos, sin datos sobre autor칤as de las mismas.

*Ejemplo de c칩mo llamar a las especies:*

*Hippodonta capitata* ------------\> (ASI SI! 九덢잺)

*Hippodonta capitata* (Ehrenb.) Lange-Bert., Metzeltin and Witkowski 1996 ------------\> (ASI NO! 游뛂)

Veamos las primeras filas y las primeras columnas:

```{r}
head(base[1:10, 1:5])
```

Cada columna representa **a una muestra**.\
Debe contener un nombre de muestra (*por ejemplo, se llaman S1_LI1_DAY0, S1_LI2_DAY0, etc.*).

**NOTA**: Los valores en las celdas pueden ser valores de densidad absoluta (como es en este ejemplo) o abundancia relativa. Por defecto, *diaThor* asume que las densidades son absolutas; si queremos cambiar esta opci칩n, debemos pasar el par치metro `isRelAb=FALSE` a `isRelAb=TRUE` cuando usamos las funciones.

#### **춰A la magia!**

Vamos a ejecutar la funci칩n `diaThorAll()` , que se encargar치 de realizar **todos los an치lisis que puede realizar el paquete**, una atr치s de otra. Y dispondremos de los resultados en un 칰nico objeto de tipo `data.frame`, que aqu칤 lo llamaremos `resultados`.

M치s adelante veremos que podemos solicitar cosas espec칤ficas si s칩lo necesitamos un tipo de resultado, para ahorrar tiempo y reducir la cantidad de salidas.

```{r chunk-4-1, results='hide', eval=FALSE}
resultados <- diaThorAll(base)
```

El paquete nos ir치 mostrando informaci칩n en la consola de RStudio, y nos solicitar치 que le indiquemos una carpeta adonde guardar todas las posibles salidas que vaya generando. Exploraremos estas salidas luego para tratar de mejorar los resultados.

`[1] "Select Results folder"`

Seleccionemos un directorio (preferentemente vac칤o!) para guardar las salidas, y el paquete continuar치 reconociendo las especies, y buscando informaci칩n ecol칩gica sobre ellas para calcular los distintos 칤ndices bi칩ticos.

#### Los resultados

Si todo ha salido bien, *diaThor* deber칤a haber calculado todos los 칤ndices posibles.

Cuando los 칤ndices bi칩ticos se publican, no necesariamente se le asigna un valor ecol칩gico a todas las especies de diatomeas (*hay unas 200.000 especies*!). Hay 칤ndices que s칩lo contemplan menos de 300 especies (ejemplos: *IDP*, *SPEAR* o los de Lobo et al.), y otros incluyen m치s de 6000 (ejemplo: *IPS*).

**En la consola veremos que porcentaje del listado de especies que ingresamos fue efectivamente utilizado para calcular cada 칤ndice.** Por ejemplo -\> *"Taxa recognized to be used in DISP index: 22.6 %"*, nos indica que de nuestras 164 especies, s칩lo utiliz칩 22.6% para calcular el 칤ndice DISP, mientras que dej칩 afuera el 77.4%. Es importante entonces delimitar qu칠 칤ndices fueron calculados sobre una base s칩lida de nuestros datos al momento de interpretar los resultados.

El final de la secuencia de c치lculo en la consola est치 delimitado por la exportaci칩n de gr치ficos (*[1] "Plots exported!"*).

En el objeto `resultados` veremos una tabla completa con todos los resultados obtenidos.

```{r chunk-5-1, results='hide', eval=FALSE}
str(resultados)
```

Es un objeto `data.table` con 109 `obs.` (nuestras muestras, filas) y 124 `vars.` (los 칤ndices calculados para cada muestra).

Veamos los resultados completos!

```{r chunk-5-2, eval=FALSE}
View(resultados)
```

![Figura 7.1. Primeras filas y columnas de la tabla de resultados de DiaThor](./images/results_diathor.png)

Veremos que cada muestra (fila) tiene sus valores de diversidad (*Richness, Shannon.H, Evenness*), porcentajes de n칰mero y forma de cloroplastos (*chorloplasts, shape.chloroplasts*), porcentaje de diatomeas de cada clase de tama침o (*size.class*), porcentaje de diatomeas de cada gremio ecol칩gico (*guilds),* los valores de cada 칤ndice de Van Dam (*VD.Salinity, VD.NHet, VD.Oxygen, VD.Saprobity, VD.Aero, VD.Trophic*) y luego todos los 칤ndices bi칩ticos.

Luego de cada uno de los 칤ndices, se encuentra una columna que indica cu치ntas especies **no fueron** determinadas en cada muestra (terminan en ".*Indet*") y cuantas fueron usadas (terminan en ".*Taxa.Used*").

#### **La sinton칤a fina: veamos las salidas!**

Una vez que el paquete termine el an치lisis, vaya a la carpeta adonde se guardaron los resultados. Se encontrar치 con varios archivos:

-   ***Diato_results - Results.csv***: Este archivo contiene la tabla principal de resultados, con cada muestra (fila) y sus valores de los diversos 칤ndices que si se pudieron calcular (columnas).

-   ***Plots.pdf***: Se incluyen los gr치ficos de cada uno de los 칤ndices bi칩ticos calculados (eje X) en cada uno de las muestras analizadas (eje Y) para poder visualizarlo. Son realizados con los mismos datos que se encuentran en la tabla de resultados.

-   ***Taxa excluded*** y ***Taxa included:*** Es MUY importante que se revisen estos dos archivos. En estos archivos veremos que taxa de nuestra lista de especies original fueron **inclu칤dos** o **exclu칤dos** en el c치lculo de cada uno de los 칤ndices. Tambi칠n nos ayudar치 a reconocer potenciales errores de tipeo o de nombramiento de especies.

    ***VanDam Taxa used.txt:*** En particular, los valores ecol칩gicos de Van Dam son separados en un archivo de texto al resto de los resultados, porque suelen ser muy amplios. Aqu칤 se indica en cada una de nuestras muestras los taxones que fueron inclu칤dos en el c치lculo de cada una de las tolerancias (*salinidad, N-heterotrof칤a, requisitos de ox칤geno, saprobiedad, humedad, estado tr칩fico*).

**Es muy importante** que antes de reportar los resultados del an치lisis, se revisen cuidadosamente las salidas del paquete. Nos pueden indicar que hay especies con el nombre mal escrito, o que para el c치lculo de alg칰n 칤ndice en particular se utiliz칩 poca cantidad de especies presentes, cuestionando as칤 la precisi칩n del mismo.

#### **Algunas aclaraciones relevantes:**

-   Sobre el reconocimiento de los nombres de las especies:

    -   DiaThor realiza **dos b칰squedas** autom치ticamente de cada especie en nuestro archivo.

        -   Primero realiza una **b칰squeda exacta** de cada especie comparandola contra todas las especies utilizadas en todos los 칤ndices bi칩ticos y ecol칩gicos.

        -   Aquellas especies que no son encontradas por este medio, las separa y las vuelve a buscar autom치ticamente por una **b칰squeda heur칤stica**, para tratar de contemplar aquellos errores en la escritura de los nombres (Quien no escribi칩 incorrectamente '*Nitzschia fasciculata*' alguna vez, que tire la primer piedra!).\
            \
            Este tipo de b칰squeda permite que haya un n칰mero determinado de caracteres distintos entre dos palabras para considerarlas iguales. Por defecto, este valor en las funciones de *diaThor* es igual a 2. Por ejemplo, la b칰squeda heur칤stica encontrar칤a a la especie '*Nitzschia fasciculata*' aunque la hubieramos escrito como '*Nitzschia fasiculata*', porque hay s칩lo 1 caracter distinto. Este valor de distancia se puede cambiar con el par치metro `maxDistTaxa`.

            **춰Cuidado!** Mientras m치s alto el valor de este par치metro, m치s chances de encontrar la especie que buscamos, pero m치s posibilidad de que confunda nuestra especie con otra de nombre similar, y se incrementa notablemente el tiempo que tarda en buscarlas.

    -   Las especies que tienen **categor칤as subespec칤ficas** (variedades y/o formas) se deben indicar con "var." y "fo.".

        -   Ejemplo: *Achnanthes exigua* var*. exigua*" o "*Gomphonema parvulum* var. *parvulum* fo. *parvulum*". El texto no busca formatos, no es necesario poner las especies en it치licas o subrayadas.\
            El paquete va a tratar de buscarlas de cualquier manera aunque no contengan estos acr칩nimos, pero las b칰squedas son m치s precisas y r치pidas cuando estan nombradas as칤.

    #### Preguntas frecuentes

-   *쮿ay problemas encontrando el archivo de entrada CSV?*

    La consola nos indica este error:

    `*cannot open file 'nuestro_archivo.csv': No such file or directory`

    Si corremos la funci칩n `diaThorAll()` directamente, sin agregar argumentos o par치metros, **un cuadro de di치logo** nos pedir치 que seleccionemos el archivo con nuestros datos.

```{r chunk-faq-1, eval=FALSE}

resultados <- diaThorAll() #sin argumentos
```

-   *쯅uestros datos est치n en abundancia relativa?*\
    Hay que indicarselo, cambiando el argumento `isRelAb` a `TRUE`.

```{r chunk-faq-2, eval=FALSE}

resultados <- diaThorAll(isRelAb=TRUE)
```

-   *쯅o encuentra las especies, y quiero hacer una b칰squeda heur칤stica m치s amplia?*\
    Cambiemos el argumento `maxDistTaxa`.

```{r chunk-faq-3, eval=FALSE}

resultados <- diaThorAll(maxDistTaxa=4) #Ahora buscar치 nombres de taxa en las bases de datos internas con hasta cuatro caracteres de diferencia al ingresado en nuestro CSV.
```

-   *쯏 si quiero s칩lo calcular un 칤ndice, en vez de todo? As칤 es m치s r치pido.*\
    Podemos usar funciones para cada 칤ndice bi칩tico o ecol칩gico.

```{r chunk-faq-4, eval=FALSE}

#Primero, cargamos nuestros datos, como siempre
base <- read.csv("sampleData_diaThor.csv") #Corroborar que el nombre del archivo coincida con el que vamos a utilizar, y que se encuentre en la carpeta de nuestro proyecto

#Luego, necesitamos que diaThor reconozca las especies por su nombre. Para esto existe la funci칩n diat_loadData()
#A esta funci칩n se le pueden pasar los mismos argumentos que a diaThorAll(). Es decir, podemos restringir la distancia heur칤stica con 'maxDistTaxa', o indicar si los datos est치n expresados en abundancia relativa con 'isRelAb'

resultados <- diat_loadData(base, isRelAb=TRUE, maxDistTaxa = 2) #Ejemplo usando abundancias relativas y la distancia heur칤stica por defecto = 2
#Deberemos indicar una carpeta para los resultados, en el cuadro de di치logo 

#Y luego, por ejemplo, podemos calcular s칩lo el 칤ndice IDP

resultadosIDP <- diat_idp(resultados) #Grabamos los resultados en el objeto resultados IDP

#o el 칤ndice IPS

resultadosIPS <- diat_ips(resultados) #Grabamos los resultados en el objeto resultados IPS

#Hay funciones separadas para todos los 칤ndices del paquete; en la documentaci칩n se indican cuales, y se van agregando con las distintas actualizaciones.

```

#### Shiny!

Hay una versi칩n online para utilizar el paquete `diaThor` a trav칠s de un entorno Shiny, en:

<https://limnolab.shinyapps.io/diathor-shiny/>

### Fuentes de informaci칩n ecol칩gica de las especies

::: {style="font-size: 9pt;"}
La informaci칩n morfol칩gica se busca en la base de datos del proyecto 'Diat.Barcode':

-   Rimet F., Gusev E., Kahlert M., Kelly M., Kulikovskiy M., Maltsev Y., Mann D., Pfannkuchen M., Trobajo R., Vasselon V., Zimmermann J., Bouchez A., 2019. Diat.barcode, an open-access curated barcode library for diatoms. Scientific Reports. <https://www.nature.com/articles/s41598-019-51500-6>

La clasificaci칩n de las especies por su clase de tama침o se obtiene de:

-   Rimet F. & Bouchez A., 2012. Life-forms, cell-sizes and ecological guilds of diatoms in European rivers. Knowledge and management of aquatic ecosystems, 406: 1-14. <https://www.kmae-journal.org/articles/kmae/abs/2012/03/kmae120025/kmae120025.html>

La clasificaci칩n de las especies en gremios ecol칩gicos se obtiene de:

-   Rimet F. & Bouchez A., 2012. Life-forms, cell-sizes and ecological guilds of diatoms in European rivers. Knowledge and management of aquatic ecosystems, 406: 1-14. <https://www.kmae-journal.org/articles/kmae/abs/2012/03/kmae120025/kmae120025.html>

La clasificaci칩n combinada de gremios y clases de tama침o (m치s nueva) se obtiene de:

-   B-B칠res, V., T칬r칬k, P., K칩kai, Z., Luk치cs, 츼., Enik콈, T., T칩thm칠r칠sz, B., & B치csi, I. (2017). Ecological background of diatom functional groups: Comparability of classification systems. Ecological Indicators, 82, 183-188. <https://www.sciencedirect.com/science/article/abs/pii/S1470160X1730420X>

Preferencias ecol칩gicas para la clasificaci칩n de Van Dam se obtienen de:

-   Van Dam, H., Mertens, A., & Sinkeldam, J. (1994). A coded checklist and ecological indicator values of freshwater diatoms from the Netherlands. Netherland Journal of Aquatic Ecology, 28(1), 117-133.

Los 칤ndices de diversidad (Shannon H') se calcula usando internamente el paquete *vegan* [@vegan]:

-   Shannon, C. E., and Weaver, W. (1949). 'The Mathematical Theory of Communication.' (University of Illinios Press: Urbana, IL, USA.)

Los valores de tolerancia y valencia de cada especie para cada 칤ndice bi칩tico se obtiene de sus fuentes publicadas originales:

-   **IPS**: Coste, M. (1982). 칄tude des m칠thodes biologiques d'appr칠ciation quantitative de la qualit칠 des eaux. Rapport Cemagref QE Lyon-AF Bassin Rh칪ne M칠diterran칠e Corse.

-   **TDI**: Kelly, M. G., & Whitton, B. A. (1995). The trophic diatom index: a new index for monitoring eutrophication in rivers. Journal of Applied Phycology, 7(4), 433-444.

-   **IDP**: G칩mez, N., & Licursi, M. (2001). The Pampean Diatom Index (IDP) for assessment of rivers and streams in Argentina. Aquatic Ecology, 35(2), 173-181.

-   **DES**: Descy, J. P. 1979. A new approach to water quality estimation using diatom. Beih. Nov Hedw. 64:305-323

-   **EPID**: Dell'Uomo, A. (1996). Assessment of water quality of an Apennine river as a pilot study for diatom-based monitoring of Italian watercourses. Use of algae for monitoring rivers, 65-72.

-   **IDAP**: Prygiel, J., & Coste, M. (1993). The assessment of water quality in the Artois-Picardie water basin (France) by the use of diatom indices. Hydrobiologia, 269(1), 343-349.

-   **ID-CH**: H칲rlimann J., Niederhauser P. 2007: M칠thodes d'analyse et d'appr칠ciation des cours d'eau. Diatom칠es Niveau R (r칠gion). 칄tat de l'environnement n춿 0740. Office f칠d칠ral de l'environnement, Berne. 132 p

-   **ILM**: Leclercq, L., & Maquet, B. (1987). Deux nouveaux indices diatomique et de qualit칠 chimique des eaux courantes. Comparaison avec diff칠rents indices existants. Cahier de Biology Marine, 28, 303-310.

-   **LOBO**:

    -   Lobo, E. A., Callegaro, V. L. M., & Bender, E. P. (2002). Utiliza칞칚o de algas diatom치ceas epil칤ticas como indicadoras da qualidade da 치gua em rios e arroios da Regi칚o Hidrogr치fica do Gua칤ba, RS, Brasil. Edunisc.

    -   Lobo, E. A., Bes, D., Tudesque, L., & Ector, L. (2004). Water quality assessment of the Pardinho River, RS, Brazil, using epilithic diatom assemblages and faecal coliforms as biological indicators. Vie et Milieu, 54(2-3), 115-126.

-   **SLA**: Sl치de캜ek, V. (1986). Diatoms as indicators of organic pollution. Acta hydrochimica et hydrobiologica, 14(5), 555-566.

-   **SPEAR(herbicides)**: Wood, R. J., Mitrovic, S. M., Lim, R. P., Warne, M. S. J., Dunlop, J., & Kefford, B. J. (2019). Benthic diatoms as indicators of herbicide toxicity in rivers--A new SPEcies At Risk (SPEARherbicides) index. Ecological Indicators, 99, 203-213.

-   **PBIDW**: Castro-Roa, D., & Pinilla-Agudelo, G. (2014). Periphytic diatom index for assessing the ecological quality of the Colombian Andean urban wetlands of Bogot치. Limnetica, 33(2), 297-312.

-   **DISP**: Stenger-Kov치cs, C., K칬rmendi, K., Lengyel, E., Abonyi, A., Hajnal, 칄., Szab칩, B., Buczk칩, K. & Padis치k, J. (2018). Expanding the trait-based concept of benthic diatoms: Development of trait-and species-based indices for conductivity as the master variable of ecological status in continental saline lakes. Ecological Indicators, 95, 63-74.
:::

------------------------------------------------------------------------

## Paquete *optimos.prime*

*Autores: Bel칠n Sathicq, Mar칤a Mercedes Nicolosi Gelis, Joaqu칤n Cochero*

### 쯈u칠 hace?

El paquete calcula los valores **칩ptimos** y **rangos de tolerancia ecol칩gicos** de los taxones a las variables ambientales que proveamos.

### 쮺칩mo lo hace?

El enfoque m치s com칰n utilizado para el c치lculo de los 칩ptimos y los rangos de tolerancia ecol칩gicos es calcular la **media ponderada** (Birks et al. 1990; Potapova y Charles, 2003).

La **media ponderada** $u_{k}$ de las estimaciones de los 칩ptimos de las especies se calcula como:

$$
u_{k} =\sum_{i=1}^{n} y_{ik}x_{i}/\sum_{i=1}^{n}y_{ik}
$$

y la **tolerancia**, o desviaci칩n est치ndar ponderada $t_{k}$, se calcula como:

$$
t_{k} = \sqrt{\frac{\sum_{i=1}^{n} y_{ik} (x_{i} - u_{k})^2}{\sum_{i=1}^{n} y_{ik}}}
$$

adonde $y_{ik}$ es la abundancia relativa de la especie $k$ en la muestra $i$; $x_{i}$ es el valor *log10* del par치metro ambiental en la muestra $i$; y $n$ es el n칰mero total de muestras del conjunto de datos.

### 춰Manos a la obra!

Como ejemplo, vamos a utilizar parte del set de datos de la tesis doctoral "*Empleo de descriptores fitoplanctonicos como biomonitores en la evaluacion de la calidad del agua en la costa del r캼o de la Plata (Franja Costera Sur)*" de M.B. Sathicq (2017) [@sathicq2017], p칰blica en el [repositorio SEDICI de la UNLP](http://sedici.unlp.edu.ar/handle/10915/58915).

#### **Descargar los datos**

Descargaremos dos sets de datos desde el repositorio del curso, y los debemos guardar en el Directorio de Trabajo del Proyecto que creamos para esta Unidad (ver c칩mo hacerlo en la Unidad \@ref(intro)).

Descargar el set de datos ambiental desde aqu칤: <https://github.com/Limno-con-R/CILCAL2023/blob/main/datasets/environmental_data_OptimosPrime.csv>

Descargar el set de dato de especies por muestras desde aqu칤: <https://github.com/Limno-con-R/CILCAL2023/blob/main/datasets/species_data_OptimosPrime.csv>\

#### Instalar el paquete

Instalaremos el paquete *optimos.prime* [@sathicq2020] como se indica en la Unidad \@ref(intro) y los cargaremos a nuestro espacio de trabajo actual:

```{r chunk-load-op, message=FALSE, warning=FALSE}

library(optimos.prime)
```

#### Cargar y previsualizar nuestro archivo de datos

Debemos cargar dos sets de datos. El primero contiene la informaci칩n de las variables ambientales en cada sitio o muestra ("*environmental_data_OptimosPrime*"). El segundo contiene la informaci칩n de abundancia relativa de los taxa en cada sitio o muestra ("*species_data_OptimosPrime*").

```{r chunk-read-csv-op, eval=FALSE}
env_data <- read.csv("environmental_data_OptimosPrime.csv") #Corroborar que el nombre del archivo coincida con el que vamos a utilizar, y que se encuentre en la carpeta de nuestro proyecto

species_data <- read.csv("species_data_OptimosPrime.csv") #Corroborar que el nombre del archivo coincida con el que vamos a utilizar, y que se encuentre en la carpeta de nuestro proyecto

#Alternativamente, para seleccionar un archivo con un cuadro de di치logo, se puede usar la funci칩n `file.choose()`, as칤:

env_data <- read.csv(file.choose()) #y seleccionar el CSV con los datos ambientales
species_data <- read.csv(file.choose()) #y seleccionar el CSV con los datos de abundancia de especies

#Cualquiera de estas dos opciones cargar치 nuestros datos a los objetos "env_data" y "species_data"
```

Veamos brevemente c칩mo est치 organizada la informaci칩n de nuestras especies:

```{r results='hide', eval=FALSE}
str(env_data)
```

`env_data` es un objeto `data.frame` con 11 `obs.` o filas (*par치metros ambientales*) y 51 `variables` o columnas (*sitios muestreados, o muestras*).

```{r results='hide', eval=FALSE}
str(species_data)
```

`species_data` es un objeto `data.frame` con 57 `obs.` o filas (*especies*) y 51 `variables` o columnas (*sitios muestreados, o muestras*).

**춰Es importante que la cantidad de variables o columnas (*sitios muestreados, o muestras*) sea igual en ambos sets de datos!**

#### **춰A la magia!**

Vamos a ejecutar la funci칩n `op_calculate()` , que se encargar치 de realizar los an치lisis de 칩ptimos ecol칩gicos y rangos de tolerancia de los taxones que ingresamos en `species_data` a las variables ambientales que ingresamos en `env_data` . Y dispondremos de los resultados en un 칰nico objeto de tipo `data.frame`, que aqu칤 lo llamaremos `resultados`.

```{r results='hide', eval=FALSE}
resultados <- op_calculate(env_data, species_data)
```

Cuando terminen los c치lculos, en la consola nos indicar치 que ya podemos ver los resultados.

`[1] "Optimum values and tolerance range calculated and placed in the final data frame"`

`[1] "Use View() to view data frame with results"`

```{r results='hide', eval=FALSE}
View(resultados)
```

#### Los resultados

Si todo ha salido bien, debemos ver que el objeto `resultados` es una nueva matriz de 57 `obs.` o filas (*especies*) y ahora 34 `variables` o columnas (*par치metros ambientales*). Es decir, por cada uno de los par치metros ambientales que ingresamos (eran 11), vamos a tener una columna con su valor de 칩ptimo ecol칩gico y otras dos columnas con su rango ecol칩gico m치ximo y su ecol칩gico rango m칤nimo (33 columnas). La primera columna contendr치 los nombres de las especies.

Veamos por ejemplo las columnas 2, 3 y 4.

La **columna 2** ("*Conductivity uS/cm*") indica el valor 칩ptimo de conductividad el칠ctrica para las especies, y el nombre con las unidades fueron ingresadas por el usuario en la matriz de datos ambientales.

La **columna 3** ("*Conductivity uS/cm - HIGH*") indica el rango de tolerancia m치ximo, y la **columna 4** ("*Conductivity uS/cm - LOW*"), el rango de tolerancia m칤nimo.

Es importante entender que los valores obtenidos responden a los 칩ptimos, m치ximos y m칤nimos de los taxones en base a los valores de los par치metros ambientales ingresamos. Si luego incorporamos nuevas muestras (por ejemplo en otros ambientes) y encontramos las mismas especies en otras condiciones ambientales, los 칩ptimos y rangos de tolerancia de esas especies van a cambiar. Es por eso que se les llama *rangos ecol칩gicos.*

#### Graficar e interpretar nuestros resultados

El paquete `optimos.prime` nos puede generar gr치ficos de tipo caterpillar con nuestros resultados para cada variable ambiental, con la funci칩n `op_plot()`. A esta funci칩n le tenemos que indicar la matriz de resultados de la funci칩n `op_calculate()`, y le podemos indicar los argumentos `label`, para personalizar la etiqueta del gr치fico, y/o el argumento `html`. 칄ste 칰ltimo indica si el gr치fico producido se realizar치 en formato HTML, que permite interactuar con los datos usando el mouse, y es el valor predeterminado. Si `html=FALSE`, nuestro gr치fico ser치 una imagen plana.

![Figura 7.2. 칍ptimos ecol칩gicos y rangos de variaci칩n para las especies de algas en referencia al pH.](./images/plot_optimosPrime.png)

En el gr치fico, se ver치n las especies (*en el eje Y*) y la variable ambiental elegida (pH, *en el eje X*). Los puntos verdes indican el **valor 칩ptimo de cada especie**, y los bigotes indican los **rangos de tolerancia** de cada especie a esa variable.

Aquellas especies con rangos de tolerancia m치s bajos (ejs. *Actinastrum fluviale*, o *Euglena* *acus*), son consideradas especies 'sensibles' a esa variable ambiental, y aquellas con grandes rangos de tolerancia (ejs. *S.nanus* o *Tetrastrum* *glabrum*) son consideradas especies 'tolerantes'. A su vez en este ejemplo, aquellas con valores 칩ptimos m치s altos (m치s arriba en el gr치fico) son consideradas mas alcal칩filas y las que se encuentran m치s abajo en el gr치fico son especies m치s acid칩filas. Es importante revisar aquellas especies que tienen rangos de tolerancia muy bajos (ej. *A. distans*), ya que puede ser el resultado de una baja cantidad de presencias de esa especie en las muestras.

```{r results='hide', eval=FALSE}
op_plot(resultados)

#En la consola nos preguntar치 que variable queremos graficar, y deberemos ingresar el n칰mero de la variable. Por ejemplo, para seleccionar el pH escribiriamos el n칰mero 2.
```

#### **Algunas aclaraciones relevantes:**

-   *쯅uestros datos no se encuentran en abundancia relativa?*\
    Hay que indicarselo, cambiando el argumento `isRelAb` a `FALSE`.

```{r eval=FALSE}

resultados <- op_calculate(isRelAb=FALSE)
```

-   *쯅uestros datos ya fueron convertidos a log10?*\
    Hay que indicarselo, cambiando el argumento `islog10` a `TRUE`.

```{r eval=FALSE}

resultados <- op_calculate(islog10=TRUE)
```

#### Shiny!

Hay una versi칩n online para utilizar el paquete `optimos.prime` a trav칠s de un entorno Shiny, en:\
<https://limnolab.shinyapps.io/OptimosPrime-Shiny/>
